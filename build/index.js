!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=13)}([function(e,t){!function(){e.exports=this.wp.element}()},function(e,t){!function(){e.exports=this.wp.components}()},function(e,t){!function(){e.exports=this.wp.i18n}()},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){!function(){e.exports=this.wp.blockEditor}()},function(e,t){!function(){e.exports=this.wp.data}()},function(e,t){!function(){e.exports=this.wp.compose}()},function(e,t,n){var o;
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
/*!
  Copyright (c) 2017 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
!function(){"use strict";var n={}.hasOwnProperty;function i(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var r=typeof o;if("string"===r||"number"===r)e.push(o);else if(Array.isArray(o)&&o.length){var c=i.apply(null,o);c&&e.push(c)}else if("object"===r)for(var s in o)n.call(o,s)&&o[s]&&e.push(s)}}return e.join(" ")}void 0!==e&&e.exports?(i.default=i,e.exports=i):void 0===(o=function(){return i}.apply(t,[]))||(e.exports=o)}()},function(e,t,n){var o=n(14);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var o=n(15),i=n(3);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?i(e):t}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t,n){"use strict";n.r(t);var o=n(12),i=n.n(o),r=n(11),c=n.n(r),s=n(10),a=n.n(s),l=n(9),p=n.n(l),u=n(3),b=n.n(u),d=n(8),m=n.n(d),g=n(0),h=n(1),f=n(4),j=n(7),y=n.n(j),O=n(6),E=n(5),v=n(2),_=wp.element.createElement,w=_("svg",{width:20,height:20},_("polygon",{fill:"#3162A7",points:"2.748,19.771 0.027,15.06 2.748,10.348 8.188,10.348 10.908,15.06 8.188,19.771"}),_("polygon",{fill:"#7F91C3",points:"11.776,14.54 9.056,9.829 11.776,5.117 17.218,5.117 19.938,9.829 17.218,14.54"}),_("polygon",{fill:"#C1C6E3",points:"2.721,9.423 0,4.712 2.721,0 8.161,0 10.882,4.712 8.161,9.423"})),I=function(e){function t(e){var n,o=e.attributes;return i()(this,t),(n=a()(this,p()(t).apply(this,arguments))).toggleIsEditing=n.toggleIsEditing.bind(b()(n)),n.updateWidth=n.updateWidth.bind(b()(n)),n.updateHeight=n.updateHeight.bind(b()(n)),n.updateDimensions=n.updateDimensions.bind(b()(n)),n.state={isEditing:!o.previewImg,isFocus:""},n}return m()(t,e),c()(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.attributes,n=e.setAttributes;t.previewUrl&&n({previewImg:t.previewUrl})}},{key:"componentDidUpdate",value:function(e){}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.attributes;e.setAttributes;this.deleteUsage(t.objectUrl,t.resourceId)}},{key:"toggleIsEditing",value:function(){this.setState({isEditing:!this.state.isEditing})}},{key:"updateWidth",value:function(e){this.props.setAttributes({objectWidth:parseInt(e,10)})}},{key:"updateHeight",value:function(e){this.props.setAttributes({objectHeight:parseInt(e,10)})}},{key:"updateDimensions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return function(){e.props.setAttributes({objectWidth:t,objectHeight:n})}}},{key:"deleteUsage",value:function(e,t){var n=this.props,o=n.attributes,i=(n.setAttributes,wp.data.select("core/editor").getCurrentPostId()),r=o.pluginURL+"/edusharing/";fetch(r+"fetch.php",{method:"post",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({useCase:"deleteUsage",post_id:i,objectUrl:e,resourceId:t})}).then(function(e){if(e.status>=200&&e.status<300)return e.text();throw new Error(e.statusText)}).then(function(e){console.log(e)})}},{key:"open_repo",value:function(e,t){var n=this.props,o=n.attributes,i=n.setAttributes;this.state.isEditing&&this.toggleIsEditing(),window.addEventListener("message",function e(t){if("APPLY_NODE"==t.data.event){var n=t.data.data;window.console.log(n),window.win.close();var r,c,s=wp.data.select("core/editor").getCurrentPostId(),a=wp.data.select("core/editor").getCurrentPost().title,l=o.pluginURL+"/edusharing/";o.objectUrl&&fetch(l+"fetch.php",{method:"post",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({useCase:"deleteUsage",post_id:s,objectUrl:o.objectUrl,resourceId:o.resourceId})}).then(function(e){if(e.status>=200&&e.status<300)return e.text();throw new Error(e.statusText)}).then(function(e){console.log(e)});var p=n.objectUrl,u=n.contentVersion,b=n.parent.repo;n.properties["ccm:height"]?(r=n.properties["ccm:height"][0],c=n.properties["ccm:width"][0]):(r="",c="");var d=n.title;d||(d=n.properties["cm:name"]);var m=s.toString()+(Math.floor(1e4*Math.random())+1e3),g=l+"preview.php?post_id="+s+"&objectUrl="+p+"&objectVersion="+u+"&repoId="+b+"&resourceId="+m;i({previewImg:n.preview.url,previewUrl:g,nodeID:n.ref.id,objectUrl:p,objectVersion:n.contentVersion,objectHeight:parseInt(r,10),objectWidth:parseInt(c,10),orgHeight:parseInt(r,10),orgWidth:parseInt(c,10),objectTitle:d.toString(),objectCaption:n.description,resourceId:parseInt(m,10),mimeType:n.mimetype,mediaType:n.mediatype,hideObj:"block"}),fetch(l+"fetch.php",{method:"post",mode:"cors",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({useCase:"setUsage",post_id:s,post_title:a,objectUrl:p,objectVersion:u,resourceId:m})}).then(function(e){if(e.status>=200&&e.status<300)return e.text();throw new Error(e.statusText)}).then(function(e){console.log(e)}),window.removeEventListener("message",e,!1)}},!1);var r=t+"/components/search?&applyDirectories=true&reurl=WINDOW&ticket="+e;window.win=window.open(r)}},{key:"render",value:function(){var e=this,t=this.state.isEditing,n=this.props,o=n.attributes,i=n.setAttributes,r=n.toggleSelection,c=n.isSelected,s=n.className,a=o.repoDomain,l=o.repoTicket,p=o.previewImg,u=o.objectTitle,b=o.objectWidth,d=o.objectHeight,m=b,j=d,O=Object(g.createElement)(h.Placeholder,{className:"es-placeholder",icon:Object(g.createElement)(f.BlockIcon,{icon:w}),label:"Edusharing"},Object(g.createElement)("div",{className:"es"},Object(g.createElement)("button",{className:"close",style:{display:o.hideObj},onClick:this.toggleIsEditing},Object(g.createElement)(h.Icon,{icon:"no-alt"})),Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Öffne das Repository um ein Edusharing-Objekt einzufügen","edusharing")),Object(g.createElement)(h.Button,{onClick:function(){e.open_repo(l,a)}},Object(v.__)("Öffne Repository","edusharing"))));if(t||!p)return Object(g.createElement)(React.Fragment,null,O);var E=y()(s,{"is-focused":c}),_=function(){return Object(g.createElement)(f.InspectorControls,null,Object(g.createElement)("div",{className:"es"},Object(g.createElement)(h.PanelBody,{title:Object(v.__)("Edusharing Einstellungen","edusharing")},Object(g.createElement)(h.TextControl,{label:Object(v.__)("Titel"),value:u,onChange:function(e){i({objectTitle:e})}}),Object(g.createElement)(h.TextareaControl,{label:"Caption",value:o.objectCaption,onChange:function(e){i({objectCaption:e})}}),Object(g.createElement)(h.TextControl,{type:"number",className:"block-library-image__dimensions__width",label:Object(v.__)("Width"),value:b||"",min:1,onChange:e.updateWidth}),Object(g.createElement)("div",null,Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Edusharing-Objekt ändern:","edusharing")),Object(g.createElement)(h.Button,{onClick:function(){e.open_repo(l,a)}},Object(v.__)("Öffne Repository","edusharing"))))))};return"link"==o.mediaType?Object(g.createElement)(React.Fragment,null,Object(g.createElement)("div",{className:"eduObject",style:{maxWidth:b}},_(),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(h.Icon,{className:"esIcon",icon:w}),Object(g.createElement)(h.Icon,{icon:"admin-links"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption))):"file-pdf"==o.mediaType?Object(g.createElement)(React.Fragment,null,Object(g.createElement)("div",{className:"eduObject"},_(),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(h.Icon,{className:"esIcon",icon:w}),Object(g.createElement)(h.Icon,{icon:"media-document"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption))):"directory"==o.mimeType||"folder"==o.mediaType?Object(g.createElement)("div",{className:"eduObject"},_(),Object(g.createElement)("div",{className:"folder esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(h.Icon,{className:"esIcon",icon:w}),Object(g.createElement)(h.Icon,{icon:"portfolio"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption)):Object(g.createElement)("div",{className:"eduObject"},function(t,n){return Object(g.createElement)(f.InspectorControls,null,Object(g.createElement)("div",{className:"es"},Object(g.createElement)(h.PanelBody,{title:Object(v.__)("Edusharing Einstellungen","edusharing")},Object(g.createElement)(h.TextControl,{label:Object(v.__)("Titel"),value:u,onChange:function(e){i({objectTitle:e})}}),t&&Object(g.createElement)("div",{className:"block-library-image__dimensions"},Object(g.createElement)("p",{className:"block-library-image__dimensions__row"},Object(v.__)("Image Dimensions")),Object(g.createElement)("div",{className:"block-library-image__dimensions__row"},Object(g.createElement)(h.TextControl,{type:"number",className:"block-library-image__dimensions__width",label:Object(v.__)("Width"),value:b||t||"",min:1,onChange:e.updateWidth}),Object(g.createElement)(h.TextControl,{type:"number",className:"block-library-image__dimensions__height",label:Object(v.__)("Height"),value:d||n||"",min:1,onChange:e.updateHeight})),Object(g.createElement)("div",{className:"block-library-image__dimensions__row"},Object(g.createElement)(h.ButtonGroup,{"aria-label":Object(v.__)("Image Size")},[25,50,75,100].map(function(o){var i=Math.round(t*(o/100)),r=Math.round(n*(o/100));return Object(g.createElement)(h.Button,{key:o,isSmall:!0,onClick:e.updateDimensions(i,r)},o,"%")})),Object(g.createElement)(h.Button,{isSmall:!0,onClick:e.updateDimensions(t,n)},Object(v.__)("Reset")))),Object(g.createElement)(h.TextareaControl,{label:"Caption",value:o.objectCaption,onChange:function(e){i({objectCaption:e})}}),Object(g.createElement)("div",null,Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Edusharing-Objekt ändern:","edusharing")),Object(g.createElement)(h.Button,{onClick:function(){e.open_repo(l,a)}},Object(v.__)("Öffne Repository","edusharing"))))))}(o.orgWidth,o.orgHeight),Object(g.createElement)("figure",{className:E+" wp-block-image"},Object(g.createElement)(h.ResizableBox,{size:{width:b,height:d},minHeight:"50",minWidth:"50",maxWidth:"1280",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},lockAspectRatio:!0,onResizeStart:function(){r(!1)},onResizeStop:function(e,t,n,o){i({objectWidth:parseInt(m+o.width,10),objectHeight:parseInt(j+o.height,10)}),r(!0)}},Object(g.createElement)("img",{src:o.previewImg,height:d,width:b,onDoubleClick:this.toggleIsEditing}),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(h.Icon,{className:"esIcon",icon:w}),o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption)))}}]),t}(g.Component),C=Object(O.compose)([Object(E.withSelect)(function(e,t){e("core/block-editor").getSettings;return{repoDomain:t.attributes.repoDomain,repoTicket:t.attributes.repoTicket}})])(I),k=wp.i18n.__,x=wp.blocks.registerBlockType,T=wp.editor,N=(T.RichText,T.InspectorControls,T.BlockIcon,T.MediaPlaceholder,wp.components),S=(N.TextControl,N.PanelBody,N.PanelRow,N.Button,N.ButtonGroup,N.IconButton,N.Placeholder,wp.element.createElement),U=S("svg",{width:20,height:20},S("polygon",{fill:"#3162A7",points:"2.748,19.771 0.027,15.06 2.748,10.348 8.188,10.348 10.908,15.06 8.188,19.771"}),S("polygon",{fill:"#7F91C3",points:"11.776,14.54 9.056,9.829 11.776,5.117 17.218,5.117 19.938,9.829 17.218,14.54"}),S("polygon",{fill:"#C1C6E3",points:"2.721,9.423 0,4.712 2.721,0 8.161,0 10.882,4.712 8.161,9.423"}));x("es/edusharing-block",{title:k("Edu-Sharing"),icon:U,category:"embed",supports:{align:!0},attributes:{repoDomain:{type:"string",source:"meta",meta:"es_repo_domain"},repoTicket:{type:"string",source:"meta",meta:"es_repo_ticket"},pluginURL:{type:"string",source:"meta",meta:"es_plugin_url"},usage:{type:"boolean",default:!1},previewImg:{type:"string"},previewUrl:{type:"string"},nodeID:{type:"string",default:""},objectUrl:{type:"string"},objectVersion:{type:"string",default:""},objectTitle:{type:"string",default:""},mimeType:{type:"string"},mediaType:{type:"string"},orgHeight:{type:"integer"},orgWidth:{type:"integer"},objectHeight:{type:"integer"},objectWidth:{type:"integer"},objectAlign:{type:"string"},objectCaption:{type:"string"},resourceId:{type:"integer"},hideObj:{type:"string",default:"none"}},edit:C,save:function(){return null}})},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,o)}e.exports=n},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=o=function(e){return n(e)}:e.exports=o=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},o(t)}e.exports=o}]);