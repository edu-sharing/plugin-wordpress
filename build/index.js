!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=15)}([function(e,t){e.exports=window.wp.element},function(e,t){e.exports=window.wp.components},function(e,t){e.exports=window.wp.i18n},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=window.wp.blockEditor},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}e.exports=function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var o=n(13);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var o=n(14).default,r=n(3);e.exports=function(e,t){return!t||"object"!==o(t)&&"function"!=typeof t?r(e):t},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var o;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var o=arguments[t];if(o){var i=typeof o;if("string"===i||"number"===i)e.push(o);else if(Array.isArray(o)){if(o.length){var c=r.apply(null,o);c&&e.push(c)}}else if("object"===i)if(o.toString===Object.prototype.toString)for(var l in o)n.call(o,l)&&o[l]&&e.push(l);else e.push(o.toString())}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)}()},function(e,t){e.exports=window.wp.compose},function(e,t){e.exports=window.wp.data},function(e,t){function n(t,o){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,n(t,o)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";n.r(t);var o=n(6),r=n.n(o),i=n(7),c=n.n(i),l=n(3),a=n.n(l),s=n(8),u=n.n(s),p=n(9),b=n.n(p),d=n(5),m=n.n(d),g=n(0),f=n(1),j=n(4),h=n(10),O=n.n(h),y=n(11),_=n(12),v=n(2);var E=wp.element.createElement,x=E("svg",{width:28,height:20},E("polygon",{fill:"#3162A7",points:"2.748,19.771 0.027,15.06 2.748,10.348 8.188,10.348 10.908,15.06 8.188,19.771"}),E("polygon",{fill:"#7F91C3",points:"11.776,14.54 9.056,9.829 11.776,5.117 17.218,5.117 19.938,9.829 17.218,14.54"}),E("polygon",{fill:"#C1C6E3",points:"2.721,9.423 0,4.712 2.721,0 8.161,0 10.882,4.712 8.161,9.423"})),w=function(e){u()(i,e);var t,n,o=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=m()(t);if(n){var r=m()(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return b()(this,e)});function i(e){var t,n=e.attributes;return r()(this,i),(t=o.apply(this,arguments)).toggleIsEditing=t.toggleIsEditing.bind(a()(t)),t.updateWidth=t.updateWidth.bind(a()(t)),t.updateHeight=t.updateHeight.bind(a()(t)),t.updateDimensions=t.updateDimensions.bind(a()(t)),t.state={isEditing:!n.previewImg,isFocus:""},t}return c()(i,[{key:"componentDidMount",value:function(){var e=this.props,t=e.attributes,n=e.setAttributes;t.previewUrl&&n({previewImg:t.previewUrl})}},{key:"componentDidUpdate",value:function(e){}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.attributes;e.setAttributes,this.deleteUsage(t.objectUrl,t.resourceId)}},{key:"toggleIsEditing",value:function(){this.setState({isEditing:!this.state.isEditing})}},{key:"updateWidth",value:function(e){this.props.setAttributes({objectWidth:parseInt(e,10)})}},{key:"updateHeight",value:function(e){this.props.setAttributes({objectHeight:parseInt(e,10)})}},{key:"updateDimensions",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return function(){e.props.setAttributes({objectWidth:t,objectHeight:n})}}},{key:"deleteUsage",value:function(e,t){var n=this.props,o=n.attributes,r=(n.setAttributes,wp.data.select("core/editor").getCurrentPostId());o.pluginURL,wp.apiFetch({path:"edusharing/v1/deleteUsage/?post_id="+r+"&objectUrl="+e+"&resourceId="+t}).then((function(e){console.log(e)}))}},{key:"open_repo",value:function(e,t){var n=this.props,o=n.attributes,r=n.setAttributes;this.state.isEditing&&this.toggleIsEditing(),window.addEventListener("message",(function e(t){if("APPLY_NODE"==t.data.event){var n=t.data.data;window.console.log(n),window.win.close();var i,c,l,a=wp.data.select("core/editor").getCurrentPostId();wp.data.select("core/editor").getCurrentPost().title,o.pluginURL,o.objectUrl&&wp.apiFetch({path:"edusharing/v1/deleteUsage/?post_id="+a+"&objectUrl="+o.objectUrl+"&resourceId="+o.resourceId}).then((function(e){console.log(e)}));var s=n.objectUrl;l=n.properties["ccm:version"]?"0":n.properties["cclom:version"][0];var u=n.parent.repo;n.properties["ccm:height"]?(i=n.properties["ccm:height"][0],c=n.properties["ccm:width"][0]):(i="",c="");var p=n.title;p||(p=n.properties["cm:name"]);var b=a.toString()+(Math.floor(1e4*Math.random())+1e3),d="";wp.apiFetch({path:"edusharing/v1/previewImg/?post_id="+a+"&objectUrl="+s+"&objectVersion="+l+"&repoId="+u+"&resourceId="+b}).then((function(e){d=e})),r({previewImg:n.preview.url,previewUrl:d,nodeID:n.ref.id,objectUrl:s,objectVersion:l,objectHeight:parseInt(i,10),objectWidth:parseInt(c,10),orgHeight:parseInt(i,10),orgWidth:parseInt(c,10),objectTitle:p.toString(),objectCaption:n.description,resourceId:parseInt(b,10),mimeType:n.mimetype,mediaType:n.mediatype,hideObj:"block"}),wp.apiFetch({path:"edusharing/v1/setUsage/?post_id="+a+"&post_id="+a+"&objectUrl="+s+"&objectVersion="+l+"&resourceId="+b}).then((function(e){console.log(e)})),window.removeEventListener("message",e,!1)}}),!1);var i=t+"/components/search?&applyDirectories=true&reurl=WINDOW&ticket="+e;window.win=window.open(i)}},{key:"render",value:function(){var e=this,t=this.state.isEditing,n=this.props,o=n.attributes,r=n.setAttributes,i=n.toggleSelection,c=n.isSelected,l=n.className,a=o.repoDomain,s=o.repoTicket,u=o.previewImg,p=o.objectTitle,b=o.objectWidth,d=o.objectHeight,m=b,h=d,y=Object(g.createElement)(f.Placeholder,{className:"es-placeholder",icon:Object(g.createElement)(j.BlockIcon,{icon:x}),label:"Edusharing"},Object(g.createElement)("div",{className:"es"},Object(g.createElement)("button",{className:"close",style:{display:o.hideObj},onClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{icon:"no-alt"})),Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Öffne das Repository um ein Edusharing-Objekt einzufügen","edusharing")),Object(g.createElement)(f.Button,{onClick:function(){e.open_repo(s,a)}},Object(v.__)("Öffne Repository","edusharing"))));if(t||!u)return Object(g.createElement)(React.Fragment,null,y);var _,E,w=O()(l,{"is-focused":c}),I=function(){return Object(g.createElement)(j.InspectorControls,null,Object(g.createElement)("div",{className:"es"},Object(g.createElement)(f.PanelBody,{title:Object(v.__)("Edusharing Einstellungen","edusharing")},Object(g.createElement)(f.TextControl,{label:Object(v.__)("Titel"),value:p,onChange:function(e){r({objectTitle:e})}}),Object(g.createElement)(f.TextareaControl,{label:"Caption",value:o.objectCaption,onChange:function(e){r({objectCaption:e})}}),Object(g.createElement)(f.TextControl,{type:"number",className:"block-library-image__dimensions__width",label:Object(v.__)("Width"),value:b||"",min:1,onChange:e.updateWidth}),Object(g.createElement)("div",null,Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Edusharing-Objekt ändern:","edusharing")),Object(g.createElement)(f.Button,{onClick:function(){e.open_repo(s,a)}},Object(v.__)("Öffne Repository","edusharing"))))))};if(!s)return Object(g.createElement)(React.Fragment,null,Object(g.createElement)("div",{className:"eduObject",style:{maxWidth:b}},I(),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{className:"esIcon",icon:x}),Object(g.createElement)("p",null,Object(v.__)("Error: No connection to edu-sharing repository.","edusharing")))));if("link"==o.mediaType)return Object(g.createElement)(React.Fragment,null,Object(g.createElement)("div",{className:"eduObject",style:{maxWidth:b}},I(),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{className:"esIcon",icon:x}),Object(g.createElement)(f.Icon,{icon:"admin-links"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption)));if("file-pdf"==o.mediaType)return Object(g.createElement)(React.Fragment,null,Object(g.createElement)("div",{className:"eduObject"},I(),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{className:"esIcon",icon:x}),Object(g.createElement)(f.Icon,{icon:"media-document"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption)));if("directory"==o.mimeType||"folder"==o.mediaType)return Object(g.createElement)("div",{className:"eduObject"},I(),Object(g.createElement)("div",{className:"folder esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{className:"esIcon",icon:x}),Object(g.createElement)(f.Icon,{icon:"portfolio"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption));if("saved_search"===o.mediaType){var C={maxItems:5,sortBy:"score"},k={};for(var T in C)void 0===o[T]&&(k[T]=C[T]);return r(k),Object(g.createElement)("div",{className:"eduObject"},Object(g.createElement)(j.InspectorControls,null,Object(g.createElement)("div",{className:"es"},Object(g.createElement)(f.PanelBody,{title:Object(v.__)("Edusharing Einstellungen","edusharing")},Object(g.createElement)(f.TextControl,{label:Object(v.__)("Titel"),value:p,onChange:function(e){r({objectTitle:e})}}),Object(g.createElement)(f.TextareaControl,{label:"Caption",value:o.objectCaption,onChange:function(e){r({objectCaption:e})}}),Object(g.createElement)(f.TextControl,{type:"number",label:Object(v.__)("Maximum number of results"),value:o.maxItems,min:1,onChange:function(e){r({maxItems:parseInt(e,10)})}}),Object(g.createElement)(f.SelectControl,{label:Object(v.__)("Sort by"),value:o.sortBy,options:[{value:"cm:modified",label:Object(v.__)("Most recently changed")},{value:"score",label:Object(v.__)("Relevance")}],onChange:function(e){r({sortBy:e})}}),Object(g.createElement)("div",null,Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Edusharing-Objekt ändern:","edusharing")),Object(g.createElement)(f.Button,{onClick:function(){e.open_repo(s,a)}},Object(v.__)("Öffne Repository","edusharing")))))),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{className:"esIcon",icon:x}),Object(g.createElement)(f.Icon,{icon:"search"}),Object(g.createElement)("p",null,o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption))}return Object(g.createElement)("div",{className:"eduObject"},(_=o.orgWidth,E=o.orgHeight,Object(g.createElement)(j.InspectorControls,null,Object(g.createElement)("div",{className:"es"},Object(g.createElement)(f.PanelBody,{title:Object(v.__)("Edusharing Einstellungen","edusharing")},Object(g.createElement)(f.TextControl,{label:Object(v.__)("Titel"),value:p,onChange:function(e){r({objectTitle:e})}}),_&&Object(g.createElement)("div",{className:"block-library-image__dimensions"},Object(g.createElement)("p",{className:"block-library-image__dimensions__row"},Object(v.__)("Image Dimensions")),Object(g.createElement)("div",{className:"block-library-image__dimensions__row"},Object(g.createElement)(f.TextControl,{type:"number",className:"block-library-image__dimensions__width",label:Object(v.__)("Width"),value:b||_||"",min:1,onChange:e.updateWidth}),Object(g.createElement)(f.TextControl,{type:"number",className:"block-library-image__dimensions__height",label:Object(v.__)("Height"),value:d||E||"",min:1,onChange:e.updateHeight})),Object(g.createElement)("div",{className:"block-library-image__dimensions__row"},Object(g.createElement)(f.ButtonGroup,{"aria-label":Object(v.__)("Image Size")},[25,50,75,100].map((function(t){var n=Math.round(_*(t/100)),o=Math.round(E*(t/100));return Object(g.createElement)(f.Button,{key:t,isSmall:!0,onClick:e.updateDimensions(n,o)},t,"%")}))),Object(g.createElement)(f.Button,{isSmall:!0,onClick:e.updateDimensions(_,E)},Object(v.__)("Reset")))),Object(g.createElement)(f.TextareaControl,{label:"Caption",value:o.objectCaption,onChange:function(e){r({objectCaption:e})}}),Object(g.createElement)("div",null,Object(g.createElement)("p",{className:"es-placeholder"},Object(v.__)("Edusharing-Objekt ändern:","edusharing")),Object(g.createElement)(f.Button,{onClick:function(){e.open_repo(s,a)}},Object(v.__)("Öffne Repository","edusharing"))))))),Object(g.createElement)("figure",{className:w+" wp-block-image"},Object(g.createElement)(f.ResizableBox,{size:{width:b,height:d},minHeight:"50",minWidth:"50",maxWidth:"1280",enable:{top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},lockAspectRatio:!0,onResizeStart:function(){i(!1)},onResizeStop:function(e,t,n,o){r({objectWidth:parseInt(m+o.width,10),objectHeight:parseInt(h+o.height,10)}),i(!0)}},Object(g.createElement)("img",{src:o.previewImg,height:d,width:b,onDoubleClick:this.toggleIsEditing}),Object(g.createElement)("div",{className:"esTitle",onDoubleClick:this.toggleIsEditing},Object(g.createElement)(f.Icon,{className:"esIcon",icon:x}),o.objectTitle)),Object(g.createElement)("p",null,o.objectCaption)))}}]),i}(g.Component),I=Object(y.compose)([Object(_.withSelect)((function(e,t){return e("core/block-editor").getSettings,{repoDomain:t.attributes.repoDomain,repoTicket:t.attributes.repoTicket}}))])(w),__=wp.i18n.__,C=wp.blocks.registerBlockType,k=wp.editor,T=(k.RichText,k.InspectorControls,k.BlockIcon,k.MediaPlaceholder,wp.components),N=(T.TextControl,T.PanelBody,T.PanelRow,T.Button,T.ButtonGroup,T.IconButton,T.Placeholder,wp.element.createElement),S=N("svg",{width:20,height:20},N("polygon",{fill:"#3162A7",points:"2.748,19.771 0.027,15.06 2.748,10.348 8.188,10.348 10.908,15.06 8.188,19.771"}),N("polygon",{fill:"#7F91C3",points:"11.776,14.54 9.056,9.829 11.776,5.117 17.218,5.117 19.938,9.829 17.218,14.54"}),N("polygon",{fill:"#C1C6E3",points:"2.721,9.423 0,4.712 2.721,0 8.161,0 10.882,4.712 8.161,9.423"}));C("es/edusharing-block",{title:__("Edu-Sharing"),icon:S,category:"embed",supports:{align:!0},attributes:{repoDomain:{type:"string",source:"meta",meta:"es_repo_domain"},repoTicket:{type:"string",source:"meta",meta:"es_repo_ticket"},pluginURL:{type:"string",source:"meta",meta:"es_plugin_url"},usage:{type:"boolean",default:!1},previewImg:{type:"string"},previewUrl:{type:"string"},nodeID:{type:"string",default:""},objectUrl:{type:"string"},objectVersion:{type:"string",default:""},objectTitle:{type:"string",default:""},mimeType:{type:"string"},mediaType:{type:"string"},orgHeight:{type:"integer"},orgWidth:{type:"integer"},objectHeight:{type:"integer"},objectWidth:{type:"integer"},objectAlign:{type:"string"},objectCaption:{type:"string"},resourceId:{type:"integer"},hideObj:{type:"string",default:"none"},maxItems:{type:"integer"},sortBy:{type:"string"}},edit:I,save:function(){return null}})}]);